
This is a job wrapper that we use in the Wisconsin CHTC glideinWMS
frontend to provide CVMFS access to jobs via parrot.

To use it, users simply need to declare that their job requires CVMFS:

+RequiresCVMFS = True

And to prevent the job from running somewhere that lacks this
capability, the following can be put in the job requirements:

Requirements = HasParrotCVMFS

(The above job requirements are recommended, but, just in case, if the
glidein fails to validate CVMFs access, the glidein START expression
automatically filters out jobs that define RequiresCVMFS=True.)

When the job runs, OSG_APP will point to /cvmfs/cms.hep.wisc.edu/osg/app.

For CMS jobs, some additional configurations are made:
  * The site squid proxy is used as the frontier proxy if it
    is determined to be a compatible version.
  * Data files are read via xrootd.

It is recommended that CMS jobs define

+RequiresCMSFrontier = True

and

Requirements = HasCMSFrontier

(The above job requirements are recommended, but, just in case, if the
glidein fails to validate Frontier access, the glidein START expression
automatically filters out jobs that define RequiresCMSFrontier=True.)



GlideinWMS frontend configuration:

Run 'make' to create the tar files referenced below.

We put the following in our global <files> section.  (Substitute a
different parrot_cfg source file as appropriate for your situation.
See parrot_cfg_* for examples.)

      <file absfname="/home/condor/wisc_glidein_scripts/parrot.tgz" after_entry="True" after_group="False" const="True" executable="False" untar="True" wrapper="False">
         <untar_options absdir_outattr="GLIDEIN_PARROT" cond_attr="TRUE"/>
      </file>
      <file absfname="/home/condor/wisc_glidein_scripts/parrot_cfg_wisc" relfname="parrot_cfg" after_entry="True" after_group="False" const="True" executable="False" untar="False" wrapper="False">
         <untar_options cond_attr="TRUE"/>
      </file>
      <file absfname="/home/condor/wisc_glidein_scripts/parrot_setup" after_entry="True" after_group="False" const="True" executable="True" untar="False" wrapper="False">
         <untar_options cond_attr="TRUE"/>
      </file>
      <file absfname="/home/condor/wisc_glidein_scripts/cvmfs_job_wrapper" after_entry="True" after_group="False" const="True" executable="False" untar="False" wrapper="True">
         <untar_options cond_attr="TRUE"/>
      </file>

Additionally, we add the following CMS-specific configuration:

      <file absfname="/home/condor/wisc_glidein_scripts/cms_siteconf.tgz" after_entry="True" after_group="False" const="True" executable="False" untar="True" wrapper="False">
         <untar_options absdir_outattr="GLIDEIN_CMS_SITECONF" cond_attr="TRUE"/>
      </file>
      <file absfname="/home/condor/wisc_glidein_scripts/parrot_cms_setup" after_entry="True" after_group="False" const="True" executable="True" untar="False" wrapper="False">
         <untar_options cond_attr="TRUE"/>
      </file>
