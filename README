
This is a job wrapper that we use in the Wisconsin CHTC glideinWMS
frontend to provide CVMFS access to jobs via parrot.

To use it, users simply need to declare that their job requires CVMFS:

+RequiresCVMFS = True

And to prevent the job from running somewhere that lacks this
capability, the following can be put in the job requirements:

Requirements = HasParrotCVMFS

(The above job requirements are recommended, but, just in case, if the
glidein fails to validate CVMFs access, the glidein START expression
automatically filters out jobs that define RequiresCVMFS=True.)

When the job runs, OSG_APP will point to /cvmfs/cms.hep.wisc.edu/osg/app.

For CMS jobs, some additional configurations are made:
  * The site squid proxy is used as the frontier proxy if it
    is determined to be a compatible version.
  * Data files are read via xrootd.

It is recommended that CMS jobs define

+RequiresCMSFrontier = True

and

Requirements = HasCMSFrontier

(The above job requirements are recommended, but, just in case, if the
glidein fails to validate Frontier access, the glidein START expression
automatically filters out jobs that define RequiresCMSFrontier=True.)



GlideinWMS frontend configuration:

We put the following in our global <files> section:

      <file absfname="/home/condor/wisc_glidein_scripts/parrot.tgz" after_entry="True" after_group="False" const="True" executable="False" untar="True" wrapper="False">
         <untar_options absdir_outattr="GLIDEIN_PARROT" cond_attr="TRUE"/>
      </file>
      <file absfname="/home/condor/wisc_glidein_scripts/parrot_setup" after_entry="True" after_group="False" const="True" executable="True" untar="False" wrapper="False">
         <untar_options cond_attr="TRUE"/>
      </file>
      <file absfname="/home/condor/wisc_glidein_scripts/cvmfs_job_wrapper" after_entry="True" after_group="False" const="True" executable="False" untar="False" wrapper="True">
         <untar_options cond_attr="TRUE"/>
      </file>

Additionally, we add the following CMS-specific configuration:

      <file absfname="/home/condor/wisc_glidein_scripts/cms_siteconf.tgz" after_entry="True" after_group="False" const="True" executable="False" untar="True" wrapper="False">
         <untar_options absdir_outattr="GLIDEIN_CMS_SITECONF" cond_attr="TRUE"/>
      </file>
      <file absfname="/home/condor/wisc_glidein_scripts/parrot_cms_setup" after_entry="True" after_group="False" const="True" executable="True" untar="False" wrapper="False">
         <untar_options cond_attr="TRUE"/>
      </file>


Optional glidein attributes that may be used to override default
behavior of the parrot cvmfs wrapper:

CVMFS_OSG_APP=/cvmfs/cms.hep.wisc.edu/osg/app   (Path of OSG_APP in cvmfs.)
GlideinRequiresParrotCVMFS=False                (If True and parrot can't access CVMFS_OSG_APP, abort glidein startup.)
GlideinRequiresCMSFrontier=False                (If True and test of Frontier squid fails, abort glidein startup.)
GlideinAlwaysUseParrotWrapper=False             (If True, all jobs are wrapped with parrot, regardless of job's RequireCVMFS attribute.)
GLIDEIN_PARROT_OPTIONS=""                       (Extra options to pass to parrot.)
